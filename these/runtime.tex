
\chapterintro

Afin de supporter les annotations relatives au modèle mémoire (validité d'un
pointeur, initialisation d'un bloc, appartenance à un bloc, etc.) nous devons
monitorer les opérations effectuées en mémoire par le programme.



\section{Annotations \eacsl liées à la mémoire}


Détaillons les annotations \acsl que nous souhaitons prendre en compte.
Elles sont au nombre de 6 : \lstinline{\base_addr}, \lstinline{\block_length},
\lstinline{\offset}, \lstinline{\valid}, \lstinline{\valid_read} et
\lstinline{\initialized}.

\input{figures/fig_mem_annots}


\lstinputlisting[caption={Annotations mémoire -- Exemple en C},
   label=lst:mem-annots,firstline=4,firstnumber=1]{listings/mem_annots.c}


\lstinline'\base_addr{L}(p)' retourne l'adresse de base du bloc alloué
qui contient, au label \lstinline{L}, le pointeur \lstinline{p}.

\lstinline'\block_length{L}(p)' retourne la longueur (en octets) du
bloc alloué qui contient, au label \lstinline{L}, le porinteur \lstinline{p}.

\lstinline'\offset{L}(p)' retourne le décalage (en octets), au label
\lstinline{L}, entre \lstinline{p} et son adresse de base.

\lstinline'\valid{L}(p)' (respectivement \lstinline'\valid_read{L}(p)') est vrai
si le déréférencement de \lstinline{p} au label \lstinline{L} est autorisé en
lecture et en écriture (resp. au moins en lecture).
\lstinline'\valid{L}(p)' implique \lstinline'\valid_read{L}(p)'
mais l'inverse n'est pas vrai.

\lstinline'\initialized{L}(p)' est un prédicat prenant un pointeur \lstinline{p}
sur une l-value en argument. Ce prédicat est vrai si la l-value en question est
initialisée au label \lstinline{L}.

Le Listing~\ref{lst:mem-annots} illustre ces annotations sur un programme C, le
programme et ses annotations sont correctes : l'exécution du programme traduit
par \eacsltoc ne génère pas d'erreur.
La Fig.~\ref{fig:mem-annots} schématise la mémoire allouée par le programme du
Listing~\ref{lst:mem-annots}.


Pour pouvoir traiter ces annotations \acsl, nous devons donc conserver
pour chaque bloc les informations suivantes :
\begin{itemize}
\item l'adresse de base
\item le nombre d'octets occupés
\item le nombre d'octets initialisés
\item l'initialisation de chaque octet (un bit par octet, sauf si aucun ou tous
  les octets sont initialisés)
\item un booléen indiquant si le bloc est en lecture seule (par exemple si c'est
  une chaîne littérale)
\item un booléen indiquant s'il y a eu un accès au bloc hors bornes
\end{itemize}

